{% extends 'base.html' %} 
{% load static %} 

{% block title %}Mi Carrito | MiXiaomiUnlock{% endblock %} 

{% block content %}
<div class="font-display animate-fade-in bg-[#F5F5F7] dark:bg-background-dark min-h-screen pt-8 pb-20">
    <div class="max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Header -->
        <div class="mb-8 flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-primary dark:text-white">Carrito de Compras</h1>
                <p class="text-gray-500 dark:text-gray-400 mt-1">Revisa tus items antes de finalizar la compra.</p>
            </div>
            <a href="{% url 'products:product-list' %}" class="hidden sm:flex items-center gap-2 text-sm font-medium text-xiaomi hover:underline">
                <span class="material-icons text-sm">arrow_back</span>
                Seguir Comprando
            </a>
        </div>

        {% if cart_count == 0 %}
        <!-- Empty State -->
        <div class="text-center py-20 animate-fade-in bg-white dark:bg-card-dark rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800">
            <div class="w-24 h-24 bg-gray-50 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="material-icons text-4xl text-gray-400">shopping_cart_checkout</span>
            </div>
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Tu carrito está vacío</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-8 max-w-md mx-auto">Parece que aún no has agregado nada. Explora nuestro catálogo y encuentra lo mejor para tu Xiaomi.</p>
            <a href="{% url 'products:product-list' %}" class="inline-flex items-center gap-2 px-8 py-4 bg-xiaomi text-white rounded-xl font-bold hover:bg-opacity-90 transition-all shadow-lg shadow-orange-500/20">
                <span class="material-icons">storefront</span>
                Ir a la Tienda
            </a>
        </div>
        
        {% else %}
        <!-- Cart Content -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start animate-slide-up">
            <!-- Cart Items -->
            <div class="lg:col-span-8 bg-white dark:bg-card-dark rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 overflow-hidden">
                <div class="p-6 md:p-8 border-b border-gray-100 dark:border-gray-800">
                    <div class="flex items-center gap-3">
                         <span class="material-icons text-xiaomi">shopping_bag</span>
                         <span id="cart-header-count" class="font-bold text-gray-900 dark:text-white">{{ cart_count }} Productos</span>
                    </div>
                </div>
                
                <div id="cart-table-container">
                    {% include 'orders/partials/cart_table.html' %}
                </div>
            </div>

            <!-- Columna Derecha: Summary -->
            <div class="lg:col-span-4 bg-white dark:bg-card-dark rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 p-6 sticky top-24">
                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Resumen del Pedido</h3>
                
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between text-gray-500 dark:text-gray-400">
                        <span>Subtotal</span>
                        <span id="cart-summary-subtotal" class="font-medium text-gray-900 dark:text-white">${{ cart.get_subtotal|floatformat:2 }}</span>
                    </div>
                    <div class="flex justify-between text-gray-500 dark:text-gray-400 pb-4 border-b border-gray-100 dark:border-gray-800">
                        <span>Envío</span>
                        <span class="text-green-500 font-bold">Gratis</span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-bold text-gray-900 dark:text-white">Total</span>
                        <span id="cart-summary-total" class="text-2xl font-bold text-primary dark:text-white">${{ cart.get_total|floatformat:2 }}</span>
                    </div>
                </div>

                <a href="{% url 'orders:checkout' %}" class="w-full py-4 bg-primary dark:bg-white text-white dark:text-black rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-opacity-90 shadow-lg shadow-blue-500/20 active:scale-95 transition-all group">
                    Pagar Ahora
                    <span class="material-icons group-hover:translate-x-1 transition-transform">arrow_forward</span>
                </a>

                <div class="mt-6 pt-6 border-t border-gray-100 dark:border-gray-800 text-center">
                    <p class="text-xs text-gray-400 flex items-center justify-center gap-2">
                        <span class="material-icons text-sm">lock</span>
                        Pagos procesados de forma segura
                    </p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- No cargamos cart.js aquí porque ya se carga en base.html globalmente -->
{% endblock %}
