{% extends 'base.html' %}
{% load static %}

{% block title %}Inicio | MiXiaomiUnlock{% endblock %}

{% block content %}
<div class="font-display animate-fade-in bg-[#F5F5F7] dark:bg-background-dark min-h-screen">
      
    <!-- Hero Section -->
    <section class="relative px-0 md:px-4 lg:px-6 pt-0 pb-0 max-w-[1500px] mx-auto mt-2">
      <div class="relative overflow-hidden md:rounded-[2rem] shadow-xl h-[280px] md:h-[360px] group border border-transparent dark:border-white/15 dark:shadow-[0_0_20px_rgba(0,0,0,0.5)]">
        
        <!-- Hero Slides Container -->
        <div id="hero-slider">
            {% for banner in banners %}
            <div class="hero-slide absolute inset-0 transition-opacity duration-1000 ease-in-out {% if forloop.first %}opacity-100 z-10{% else %}opacity-0 z-0{% endif %} bg-black" data-index="{{ forloop.counter0 }}">
                <div class="absolute inset-0">
                    {% if banner.image %}
                    <img src="{{ banner.image.url }}" 
                         class="w-full h-full object-cover object-center md:object-right opacity-80" 
                         alt="{{ banner.title }}"
                         width="1500"
                         height="360"
                         {% if forloop.first %}fetchpriority="high"{% endif %}
                         decoding="async">
                    {% else %}
                    <div class="w-full h-full bg-gray-800 opacity-80 flex items-center justify-center">
                        <span class="text-white">Sin imagen</span>
                    </div>
                    {% endif %}
                    <div class="absolute inset-0 bg-gradient-to-r from-black/90 via-black/60 to-transparent"></div>
                </div>
                <div class="absolute inset-0 flex flex-col justify-center px-6 md:px-24 max-w-4xl z-20">
                    <div class="slide-content transform transition-all duration-700 delay-100 {% if forloop.first %}translate-y-0 opacity-100{% else %}translate-y-4 opacity-0{% endif %}">
                        <div class="inline-flex items-center gap-2 mb-2 px-3 py-1 rounded-full border border-white/10 bg-white/5 backdrop-blur-md text-white shadow-lg">
                             <span class="w-1.5 h-1.5 rounded-full bg-xiaomi animate-pulse"></span>
                             <span class="text-[10px] font-bold uppercase tracking-[0.15em]">Novedad</span>
                        </div>
                        <h1 class="text-3xl md:text-5xl font-bold mb-2 leading-none tracking-tight text-white drop-shadow-lg">
                            {{ banner.title|linebreaksbr }}
                        </h1>
                        <p class="text-sm md:text-base mb-5 max-w-lg leading-snug text-gray-300 font-light hidden sm:block">
                            Descubre nuestros servicios y productos destacados.
                        </p>
                        {% if banner.link %}
                        <div class="flex gap-3">
                            <a href="{{ banner.link }}" class="px-5 py-2.5 rounded-xl font-bold text-xs md:text-sm transition-all transform hover:-translate-y-0.5 hover:shadow-lg bg-white text-black hover:bg-gray-100">Ver Más</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <!-- Default Static Slide if no banners -->
            <div class="hero-slide absolute inset-0 transition-opacity duration-1000 ease-in-out opacity-100 z-10 bg-black" data-index="0">
                <div class="absolute inset-0">
                    <img src="https://images.unsplash.com/photo-1621330396173-e41b1cafd17f?auto=format&fit=crop&q=80&w=1200" 
                         class="w-full h-full object-cover object-center md:object-right opacity-80" 
                         alt="Hero Default"
                         width="1500"
                         height="360"
                         fetchpriority="high"
                         decoding="async">
                    <div class="absolute inset-0 bg-gradient-to-r from-black/90 via-black/60 to-transparent"></div>
                </div>
                <div class="absolute inset-0 flex flex-col justify-center px-6 md:px-24 max-w-4xl z-20">
                    <div class="slide-content transform transition-all duration-700 delay-100 translate-y-0 opacity-100">
                        <div class="inline-flex items-center gap-2 mb-2 px-3 py-1 rounded-full border border-white/10 bg-white/5 backdrop-blur-md text-white shadow-lg">
                             <span class="w-1.5 h-1.5 rounded-full bg-xiaomi animate-pulse"></span>
                             <span class="text-[10px] font-bold uppercase tracking-[0.15em]">Bienvenido</span>
                        </div>
                        <h1 class="text-3xl md:text-5xl font-bold mb-2 leading-none tracking-tight text-white drop-shadow-lg">
                            Bienvenido a <br/>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-xiaomi to-accent font-extrabold">MiXiaomiUnlock</span>
                        </h1>
                        <p class="text-sm md:text-base mb-5 max-w-lg leading-snug text-gray-300 font-light hidden sm:block">
                            Servicio Especializado para dispositivos Xiaomi & Poco.
                        </p>
                        <div class="flex gap-3">
                            <a href="{% url 'products:product-list' %}" class="px-5 py-2.5 rounded-xl font-bold text-xs md:text-sm transition-all transform hover:-translate-y-0.5 hover:shadow-lg bg-white text-black hover:bg-gray-100">Ver Productos</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Controls -->
        <div class="absolute bottom-6 right-8 flex gap-2 z-30" id="hero-dots">
            {% for banner in banners %}
            <button class="hero-dot h-1 rounded-full transition-all duration-500 {% if forloop.first %}bg-xiaomi w-6{% else %}bg-white/20 w-1.5 hover:bg-white/40{% endif %}" data-index="{{ forloop.counter0 }}" aria-label="Ir a diapositiva {{ forloop.counter }}"></button>
            {% empty %}
            <button class="hero-dot h-1 rounded-full transition-all duration-500 bg-xiaomi w-6" data-index="0" aria-label="Ir a diapositiva 1"></button>
            {% endfor %}
        </div>
      </div>
    </section>

    <!-- Separator -->
    <div class="w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-8 my-6">
        <div class="h-[1px] w-full bg-gradient-to-r from-xiaomi to-accent rounded-full opacity-80"></div>
    </div>

    <!-- Brands Strip -->
    <div class="py-2">
         <div class="max-w-7xl mx-auto overflow-hidden opacity-90 hover:opacity-100 transition-opacity duration-500 relative z-10">
           <div class="flex animate-marquee hover:[animation-play-state:paused] items-center whitespace-nowrap">
               <!-- Repeated items for marquee effect -->
               {% for i in "012345" %} 
                  <div class="mx-8 md:mx-12 shrink-0"><img src="{% static 'assets/icons/xiaomi.svg' %}" class="h-12 w-auto object-contain grayscale hover:grayscale-0 transition-all duration-300 dark:invert" alt="Xiaomi" width="100" height="48" loading="lazy"></div>
                  <div class="mx-8 md:mx-12 shrink-0"><img src="{% static 'assets/icons/apple.svg' %}" class="h-12 w-auto object-contain grayscale hover:grayscale-0 transition-all duration-300 dark:invert" alt="Apple" width="48" height="48" loading="lazy"></div>
                  <div class="mx-8 md:mx-12 shrink-0"><img src="{% static 'assets/icons/samsung.svg' %}" class="h-12 w-auto object-contain grayscale hover:grayscale-0 transition-all duration-300 dark:invert" alt="Samsung" width="150" height="48" loading="lazy"></div>
                  <div class="mx-8 md:mx-12 shrink-0"><img src="{% static 'assets/icons/huawei.svg' %}" class="h-12 w-auto object-contain grayscale hover:grayscale-0 transition-all duration-300 dark:invert" alt="Huawei" width="48" height="48" loading="lazy"></div>
               {% endfor %}
           </div>
         </div>
    </div>

    <!-- Separator -->
    <div class="w-full max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 my-6">
        <div class="h-[1px] w-full bg-gradient-to-r from-xiaomi to-accent rounded-full opacity-80"></div>
    </div>

       <div class="flex flex-col md:flex-row justify-between items-end mb-10">
          <div>
              <h2 class="text-3xl font-bold text-primary dark:text-white tracking-tight">Catálogo de Servicios</h2>
              <div class="h-1 w-20 bg-gradient-to-r from-xiaomi to-accent rounded-full mt-2"></div>
              <p class="mt-4 text-gray-500 dark:text-gray-400 text-base">Reparaciones certificadas y software especializado.</p>
          </div>
          
          <!-- Tab Switcher -->
          <div class="bg-white dark:bg-card-dark p-1 rounded-xl flex gap-1 mt-4 md:mt-0 shadow-sm border border-gray-100 dark:border-gray-800">
              <button type="button" id="tab-services" class="px-5 py-2 rounded-lg text-sm font-bold transition-all bg-primary dark:bg-white text-white dark:text-black shadow-md cursor-pointer select-none">
                  Servicios
              </button>
              <button type="button" id="tab-products" class="px-5 py-2 rounded-lg text-sm font-bold transition-all text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer select-none">
                  Productos
              </button>
          </div>
       </div>

       <!-- Container for SERVICES (Active by default) -->
       <div id="content-services" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 items-start">
           {% for service in services %}
           <div class="group bg-white dark:bg-card-dark rounded-2xl border border-gray-100 dark:border-gray-800/50 overflow-hidden hover:border-gray-200 dark:hover:border-gray-700 transition-all duration-300 cursor-pointer flex flex-col h-auto max-w-[280px] mx-auto w-full relative">
               
                <div class="relative h-72 w-full overflow-hidden bg-white dark:bg-[#0a0a0a]">
                    <a href="{% url 'products:product-detail' service.id %}" class="block h-full w-full">
                        {% if service.image %}
                        <img src="{{ service.image.url }}" class="w-full h-full object-contain p-4 group-hover:scale-110 transition-transform duration-700" alt="{{ service.name }}">
                        {% else %}
                        <div class="w-full h-full flex flex-col items-center justify-center bg-gray-50 dark:bg-white/5 text-gray-300">
                            <span class="material-icons text-6xl mb-2" aria-hidden="true">build_circle</span>
                            <span class="text-xs font-bold uppercase tracking-wider">Servicio</span>
                        </div>
                        {% endif %}
                    </a>
                    
                    {% if service.is_new %}
                    <span class="absolute top-3 left-3 bg-blue-500 text-white text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wide shadow-md">NUEVO</span>
                    {% endif %}

                    <!-- Favorite Button -->
                    <button 
                        onclick="toggleFavorite(this, {{ service.id }})"
                        class="absolute top-3 right-3 w-8 h-8 bg-white dark:bg-card-dark rounded-full flex items-center justify-center shadow-md transition-all duration-300 z-30 hover:scale-110 {% if service.id in user_favorites %}text-red-500{% else %}text-gray-400 hover:text-red-500{% endif %}"
                    >
                        <span class="material-icons text-[16px]">
                            {% if service.id in user_favorites %}favorite{% else %}favorite_border{% endif %}
                        </span>
                    </button>
                </div>

               <div class="p-4 flex flex-col bg-white dark:bg-card-dark relative z-20">
                   <h3 class="font-bold text-gray-900 dark:text-white mb-1 truncate text-lg leading-tight">
                       <a href="{% url 'products:product-detail' service.id %}">{{ service.name }}</a>
                   </h3>
                   <p class="text-sm text-gray-500 dark:text-gray-400 leading-snug line-clamp-2 mb-3 min-h-[2.5em]">{{ service.description|truncatechars:60 }}</p>
                   
                   <div class="flex justify-between items-center pt-3 border-t border-gray-50 dark:border-gray-800 mt-auto">
                       <div class="flex flex-col">
                           <span class="text-xl font-bold text-primary dark:text-white leading-none">${{ service.price }}</span>
                       </div>
                       <button onclick="addToCart({{ service.id }})" class="w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-800 text-primary dark:text-white hover:bg-xiaomi hover:text-white transition-all shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-center active:scale-95">
                           <span class="material-icons text-xl">add_shopping_cart</span>
                       </button>
                   </div>
               </div>
           </div>
           {% empty %}
            <div class="col-span-full py-12 text-center text-gray-500 bg-gray-50 dark:bg-white/5 rounded-2xl border border-dashed border-gray-200 dark:border-gray-700">
                <span class="material-icons text-4xl mb-2 text-gray-400">miscellaneous_services</span>
                <p>No tenemos servicios disponibles en este momento.</p>
            </div>
           {% endfor %}
       </div>

       <!-- Container for PRODUCTS (Hidden by default) -->
       <div id="content-products" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 items-start">

           {% for product in products %}

           <div class="group bg-white dark:bg-card-dark rounded-2xl border border-gray-100 dark:border-gray-800/50 overflow-hidden hover:border-gray-200 dark:hover:border-gray-700 transition-all duration-300 cursor-pointer flex flex-col h-auto max-w-[280px] mx-auto w-full relative">
               
                <div class="relative h-72 w-full overflow-hidden bg-white dark:bg-[#0a0a0a]">
                    <a href="{% url 'products:product-detail' product.id %}" class="block h-full w-full">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" class="w-full h-full object-contain p-4 group-hover:scale-110 transition-transform duration-700" alt="{{ product.name }}">
                        {% else %}
                        <img src="https://via.placeholder.com/300?text=No+Image" class="w-full h-full object-cover grayscale opacity-50" alt="No image">
                        {% endif %}
                    </a>
                    
                    {% if product.is_new %}
                    <span class="absolute top-3 left-3 bg-green-500 text-white text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wide shadow-md">NUEVO</span>
                    {% endif %}
                    
                    <!-- Favorite Button -->
                    <button 
                        onclick="toggleFavorite(this, {{ product.id }})"
                        class="absolute top-3 right-3 w-8 h-8 bg-white dark:bg-card-dark rounded-full flex items-center justify-center shadow-md transition-all duration-300 z-30 hover:scale-110 {% if product.id in user_favorites %}text-red-500{% else %}text-gray-400 hover:text-red-500{% endif %}"
                    >
                        <span class="material-icons text-[16px]">
                            {% if product.id in user_favorites %}favorite{% else %}favorite_border{% endif %}
                        </span>
                    </button>
                </div>

               <div class="p-4 flex flex-col bg-white dark:bg-card-dark relative z-20">
                   <h3 class="font-bold text-gray-900 dark:text-white mb-1 truncate text-lg leading-tight">
                       <a href="{% url 'products:product-detail' product.id %}">{{ product.name }}</a>
                   </h3>
                   <div class="flex items-center gap-1 mb-2">
                        <div class="flex text-yellow-400 text-xs">
                           <span class="material-icons text-[14px]" aria-hidden="true">star</span>
                           <span class="material-icons text-[14px]" aria-hidden="true">star</span>
                           <span class="material-icons text-[14px]" aria-hidden="true">star</span>
                           <span class="material-icons text-[14px]" aria-hidden="true">star</span>
                           <span class="material-icons text-[14px]" aria-hidden="true">star_border</span>
                        </div>
                   </div>
                   <p class="text-sm text-gray-500 dark:text-gray-400 leading-snug line-clamp-2 mb-3">{{ product.description|truncatechars:60 }}</p>
                   
                   <div class="flex justify-between items-center pt-3 border-t border-gray-50 dark:border-gray-800 mt-auto">
                       <div class="flex flex-col">
                           <span class="text-xl font-bold text-primary dark:text-white leading-none">${{ product.price }}</span>
                       </div>
                       <button onclick="addToCart({{ product.id }})" class="w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-800 text-primary dark:text-white hover:bg-xiaomi hover:text-white transition-all shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-center active:scale-95">
                           <span class="material-icons text-xl">add_shopping_cart</span>
                       </button>
                   </div>
               </div>
           </div>
           {% empty %}
            <div class="col-span-full py-12 text-center text-gray-500">
                <p>No hay productos disponibles por el momento.</p>
            </div>
           {% endfor %}
       </div>

       <!-- Container for SERVICES (Static Examples fallback) -->
       <div id="content-services-static" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 items-start">
          <div class="col-span-full py-12 text-center text-gray-500 bg-white dark:bg-card-dark rounded-2xl border border-dashed border-gray-200">
              <span class="material-icons text-4xl mb-2" aria-hidden="true">build</span>
              <p>El catálogo de servicios se cargará próximamente.</p>
           </div>
       </div>

    </section>

    <!-- Bento Grid Education Section -->
    <section class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 mt-16 mb-16 font-display">
        <div class="text-center mb-12 animate-fade-in-up">
            <h2 class="text-2xl md:text-3xl font-black mb-4 tracking-tight leading-none uppercase">
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-xiaomi to-accent">¿TIENES PROBLEMAS CON TU SMARTPHONE?</span>
            </h2>
            <p class="text-lg text-gray-500 dark:text-gray-400 font-medium">
                No te preocupes. <span class="font-bold text-gray-900 dark:text-white bg-yellow-400/20 px-2 rounded-lg">Te tenemos la solución.</span>
            </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 auto-rows-[240px]">
            <!-- Large Main Card (Mascota) -->
            <div id="bento-large-card" class="lg:col-span-2 lg:row-span-2 relative overflow-hidden rounded-[2rem] shadow-2xl group cursor-pointer transition-all duration-700 hover:shadow-orange-500/20 flex flex-col bg-white dark:bg-[#0F1C2E]">
                 
                 <!-- Image Area (70%) -->
                 <div class="h-[65%] sm:h-[70%] w-full relative overflow-hidden bg-white dark:bg-gray-900 border-b-4 border-yellow-400">
                     <img id="bento-large-img-current" src="{% static 'assets/images/Mascota-xiaomi-enojado.png' %}" class="w-full h-full object-contain p-4 transition-transform duration-700 group-hover:scale-105" alt="Problemas de Bloqueo">
                     <img id="bento-large-img-prev" src="" class="absolute inset-0 w-full h-full object-contain p-4 hidden transition-all duration-500 opacity-0 scale-110">
                 </div>
                 
                 <!-- Text Area (30%) - Xiaomi Orange Background -->
                 <div class="h-[35%] sm:h-[30%] w-full bg-xiaomi p-6 md:p-8 flex flex-col justify-center relative z-20">
                     <!-- Decorative pattern overlay -->
                     <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                     
                     <div class="relative z-10">
                         <h3 id="bento-large-title" class="text-2xl md:text-3xl font-black text-white mb-2 leading-tight tracking-tight">¿Frustrado con tu bloqueo?</h3>
                         <p id="bento-large-desc" class="text-white/90 text-sm md:text-lg font-medium leading-relaxed line-clamp-2">Entendemos tu molestia. Recupera el acceso total a tu dispositivo Xiaomi hoy mismo.</p>
                     </div>
                 </div>
            </div>

            <!-- Card 1: IMEI -->
            <div class="bento-small-card relative overflow-hidden rounded-[2rem] shadow-lg group cursor-pointer hover:scale-[1.02] transition-all bg-black"
                 data-img="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?auto=format&fit=crop&q=80&w=800"
                 data-title="¿Qué es el IMEI?"
                 data-desc="Es la huella digital única global de tu equipo. Vital para reportes y garantías.">
                 <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?auto=format&fit=crop&q=80&w=800" class="w-full h-full object-cover opacity-60 transition-transform duration-700 group-hover:scale-110 group-hover:opacity-40">
                 <div class="absolute inset-0 flex flex-col justify-end p-6 z-20">
                     <h4 class="text-xl font-bold text-white group-hover:text-xiaomi transition-colors leading-tight">¿Qué es el IMEI?</h4>
                 </div>
            </div>

            <!-- Card 2: Google Cloud -->
            <div class="bento-small-card relative overflow-hidden rounded-[2rem] shadow-lg group cursor-pointer hover:scale-[1.02] transition-all bg-black"
                 data-img="https://images.unsplash.com/photo-1555421689-491a97ff2040?auto=format&fit=crop&q=80&w=800"
                 data-title="Bloqueo Google"
                 data-desc="FRP (Factory Reset Protection) se activa al resetear sin cerrar sesión.">
                 <img src="https://images.unsplash.com/photo-1555421689-491a97ff2040?auto=format&fit=crop&q=80&w=800" class="w-full h-full object-cover opacity-60 transition-transform duration-700 group-hover:scale-110 group-hover:opacity-40">
                 <div class="absolute inset-0 flex flex-col justify-end p-6 z-20">
                     <h4 class="text-xl font-bold text-white group-hover:text-xiaomi transition-colors leading-tight">Bloqueo Google</h4>
                 </div>
            </div>
            
             <!-- Card 3: Mi Cloud -->
            <div class="bento-small-card relative overflow-hidden rounded-[2rem] shadow-lg group cursor-pointer hover:scale-[1.02] transition-all bg-black"
                 data-img="{% static 'assets/images/micloud.png' %}"
                 data-title="Cuenta Mi Cloud"
                 data-desc="Seguridad exclusiva de Xiaomi. Si olvidas tu clave, el dispositivo queda inutilizable.">
                 <img src="{% static 'assets/images/micloud.png' %}" class="w-full h-full object-cover opacity-60 transition-transform duration-700 group-hover:scale-110 group-hover:opacity-40">
                 <div class="absolute inset-0 flex flex-col justify-end p-6 z-20">
                     <h4 class="text-xl font-bold text-white group-hover:text-xiaomi transition-colors leading-tight">Cuenta Mi Cloud</h4>
                 </div>
            </div>
            
            <!-- Card 4: Bootloader -->
            <div class="bento-small-card relative overflow-hidden rounded-[2rem] shadow-lg group cursor-pointer hover:scale-[1.02] transition-all bg-black"
                 data-img="https://images.unsplash.com/photo-1526498460520-4c246339dccb?auto=format&fit=crop&q=80&w=800"
                 data-title="Bootloader"
                 data-desc="Gestor de arranque bloqueado por el fabricante. Necesario desbloquear para modificar software.">
                 <img src="https://images.unsplash.com/photo-1526498460520-4c246339dccb?auto=format&fit=crop&q=80&w=800" class="w-full h-full object-cover opacity-60 transition-transform duration-700 group-hover:scale-110 group-hover:opacity-40">
                 <div class="absolute inset-0 flex flex-col justify-end p-6 z-20">
                     <h4 class="text-xl font-bold text-white group-hover:text-xiaomi transition-colors leading-tight">Bootloader</h4>
                 </div>
            </div>

            <!-- Dynamic Card Preview (from DB) using available products -->
            {% for product in products|slice:":2" %}
            <div class="bento-small-card relative overflow-hidden rounded-[2rem] shadow-lg group cursor-pointer hover:scale-[1.02] transition-all bg-white dark:bg-card-dark border border-gray-100 dark:border-gray-800"
                 data-img="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/400{% endif %}"
                 data-title="{{ product.name }}"
                 data-desc="{{ product.description|truncatechars:80 }}">
                 <div class="absolute inset-0 p-4 flex items-center justify-center bg-gray-50 dark:bg-white/5">
                     <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/400{% endif %}" class="w-3/4 h-auto object-contain transition-transform duration-700 group-hover:scale-110 group-hover:rotate-3">
                 </div>
                 <div class="absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-white dark:from-black via-white/80 dark:via-black/80 to-transparent">
                     <h4 class="text-lg font-bold text-gray-900 dark:text-white truncate">{{ product.name }}</h4>
                 </div>
            </div>
            {% endfor %}

        </div>
    </section>

    <!-- Separator -->
    <div class="w-full max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 my-16">
        <div class="h-[1px] w-full bg-gradient-to-r from-xiaomi to-accent rounded-full opacity-80"></div>
    </div>

    <!-- Testimonials Section -->
    <section class="pb-20 pt-4">
        <div class="max-w-7xl mx-auto px-6">
             <div class="grid md:grid-cols-2 gap-16 items-center">
                 <div>
                     <span class="text-xiaomi font-bold uppercase tracking-widest text-xs mb-2 block">Garantía Total</span>
                     <h2 class="text-3xl md:text-4xl font-bold text-primary dark:text-white mb-6 leading-tight">
                         Técnicos Certificados <br/> <span class="text-gray-400 dark:text-gray-500">Herramientas Oficiales.</span>
                     </h2>
                     <p class="text-gray-500 dark:text-gray-400 leading-relaxed mb-8 text-base">
                         Utilizamos software oficial como MiFlash Pro y esquemáticos originales. Tu dispositivo mantiene su garantía y funcionalidad intacta.
                     </p>
                     
                     <div class="grid grid-cols-2 gap-4">
                         <div class="p-5 bg-white dark:bg-card-dark rounded-2xl border border-gray-100 dark:border-gray-800">
                             <h4 class="font-bold text-2xl text-primary dark:text-white mb-0.5">20min</h4>
                             <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Tiempo promedio</p>
                         </div>
                         <div class="p-5 bg-white dark:bg-card-dark rounded-2xl border border-gray-100 dark:border-gray-800">
                             <h4 class="font-bold text-2xl text-primary dark:text-white mb-0.5">90 Días</h4>
                             <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Garantía extendida</p>
                         </div>
                     </div>
                 </div>
                 
                 <div class="relative">
                     <!-- Testimonial Card -->
                     <div class="relative z-10 rounded-[2rem] p-[2px] bg-white dark:bg-gradient-to-r dark:from-xiaomi dark:to-accent shadow-xl transition-all duration-300 hover:shadow-2xl">
                        <div class="bg-white dark:bg-card-dark rounded-[2rem] p-8 h-full relative" id="testimonial-card">
                            <div class="animate-fade-in">
                                <div class="flex items-center gap-4 mb-6">
                                    <img id="testim-img" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&q=80&w=150" class="w-14 h-14 rounded-xl object-cover shadow-md" alt="User" />
                                    <div>
                                        <h4 id="testim-author" class="font-bold text-lg text-primary dark:text-white">Marcela V.</h4>
                                        <div class="flex text-xiaomi text-xs mt-0.5">
                                            <span class="material-icons text-base">star</span>
                                            <span class="material-icons text-base">star</span>
                                            <span class="material-icons text-base">star</span>
                                            <span class="material-icons text-base">star</span>
                                            <span class="material-icons text-base">star</span>
                                        </div>
                                    </div>
                                </div>
                                <p id="testim-text" class="text-gray-600 dark:text-gray-300 italic mb-6 text-base leading-relaxed h-20">"La rapidez con la que liberaron mi iPhone 14 Pro fue impresionante. En 20 minutos ya tenía señal."</p>
                                <div class="flex items-center gap-2 text-xs font-bold text-green-700 bg-green-100 dark:text-green-400 dark:bg-green-900/20 px-3 py-1.5 rounded-full w-max">
                                    <span class="material-icons text-xs">verified</span> Compra Verificada
                                </div>
                            </div>
                        </div>
                     </div>

                     <!-- Nav Buttons -->
                     <div class="flex justify-center gap-4 mt-8 relative z-10">
                         <button id="prev-testim" class="w-12 h-12 rounded-full border border-gray-200 dark:border-gray-700 hover:bg-white hover:text-accent bg-white/50 backdrop-blur-sm flex items-center justify-center transition-all">
                             <span class="material-icons">chevron_left</span>
                         </button>
                         <button id="next-testim" class="w-12 h-12 rounded-full border border-gray-200 dark:border-gray-700 hover:bg-white hover:text-accent bg-white/50 backdrop-blur-sm flex items-center justify-center transition-all">
                             <span class="material-icons">chevron_right</span>
                         </button>
                     </div>
                 </div>
             </div>
        </div>
    </section>

    <!-- BOTON FLOTANTE WHASTAPP -->
    <a href="https://wa.me/573000000000?text=Hola,%20necesito%20ayuda%20con%20mi%20Xiaomi" 
       id="btn-whatsapp" 
       target="_blank" 
       rel="noopener noreferrer"
       class="group fixed bottom-6 right-6 z-[99] flex h-14 w-14 items-center justify-center rounded-full bg-[#25D366] text-white shadow-lg transition-transform duration-300 hover:scale-110 focus:outline-none"
       aria-label="Contactar por WhatsApp">
        
        <span class="absolute right-full mr-3 w-auto min-w-max rounded-md bg-gray-800 px-3 py-2 text-center text-sm font-bold text-white opacity-0 shadow-md transition-opacity duration-300 group-hover:opacity-100 dark:bg-white dark:text-gray-900" aria-hidden="true">
            ¿Necesitas ayuda?
            <span class="absolute top-1/2 -right-1 h-2 w-2 -translate-y-1/2 rotate-45 bg-gray-800 dark:bg-white"></span>
        </span>

        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M20.5 3.5A12.5 12.5 0 0 0 12 0 12.5 12.5 0 0 0 1.5 15.3l-1.4 4.5 4.6-1.4A12.5 12.5 0 0 0 12 24a12.5 12.5 0 0 0 12.5-12.5c0-3-1.1-5.8-3-8zM12 22.5c-1.8 0-3.5-.5-5-1.4l-.4-.2-3.7 1.1 1.1-3.6-.3-.4A10.5 10.5 0 1 1 12 22.5zM18.2 14.4c-.3-.1-1.7-.8-2-1-.2-.1-.4-.1-.6.1-.2.2-.8 1-.9 1.2-.2.2-.3.2-.6.1s-1.2-.4-2.3-1.4c-.8-.8-1.4-1.8-1.6-2.1-.2-.3 0-.5.1-.6s.3-.4.4-.5c.1-.1.2-.3.3-.4.1-.2 0-.3-.1-.4-.1-.1-.6-1.5-.8-2-.2-.5-.4-.4-.5-.4h-.4c-.2 0-.4.1-.6.3s-.8.8-.8 2c0 1.2.8 2.3 1 2.5s1.7 2.6 4.2 3.7c.6.2 1 .4 1.4.5.6.2 1.1.1 1.5.1.5-.1 1.7-.7 2-1.3.3-.6.3-1.1.2-1.2s-.3-.2-.6-.3z"/>
        </svg>
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Pass Django data to JavaScript
    window.TESTIMONIALS_DATA = [
        {% for testimonial in testimonials %}
        {
            text: "{{ testimonial.comment|escapejs }}",
            author: "{{ testimonial.user.get_full_name|default:testimonial.user.username|escapejs }}",
            image: "{% if testimonial.user.profile.avatar %}{{ testimonial.user.profile.avatar.url }}{% else %}https://ui-avatars.com/api/?name={{ testimonial.user.username }}&background=random{% endif %}"
        },
        {% endfor %}
    ];
</script>
<script src="{% static 'js/home.js' %}" defer></script>

<script>
    // Slider and interactions managed by home.js
</script>
{% endblock %}
