{% load static %}

<!-- Mini Cart Header -->
<div class="px-5 py-4 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center bg-gray-50/50 dark:bg-black/20 backdrop-blur-sm">
    <div class="flex items-center gap-2">
        <span class="material-icons text-xiaomi text-xl">shopping_bag</span>
        <h3 class="font-bold text-gray-900 dark:text-white text-base">Carrito</h3>
    </div>
    <span class="text-xs font-bold text-white bg-gray-900 dark:bg-gray-700 px-2.5 py-1 rounded-full">{{ cart_count }} items</span>
</div>

<!-- Mini Cart Items -->
<div class="max-h-[320px] overflow-y-auto custom-scrollbar p-3 space-y-2">
    {% for item in cart_items %}
    <div class="flex items-start gap-4 p-3 bg-white dark:bg-card-dark hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition-all duration-200 group border border-transparent hover:border-gray-100 dark:hover:border-gray-700 shadow-sm hover:shadow-md">
        <!-- Image -->
        <div class="w-16 h-16 bg-gray-50 dark:bg-gray-900 rounded-lg flex items-center justify-center flex-shrink-0 overflow-hidden border border-gray-100 dark:border-gray-800">
            {% if item.product.image %}
                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-full h-full object-contain p-1 group-hover:scale-110 transition-transform duration-300">
            {% else %}
                <span class="material-icons text-gray-300">image</span>
            {% endif %}
        </div>
        
        <!-- Info -->
        <div class="flex-1 min-w-0 flex flex-col justify-between h-16 py-0.5">
            <div>
                <h4 class="text-sm font-bold text-gray-900 dark:text-white truncate leading-tight">{{ item.product.name }}</h4>
                <p class="text-[10px] text-gray-400 uppercase tracking-wider mt-1">{{ item.product.category|default:'Producto' }}</p>
            </div>
            
              <div class="flex items-center justify-between mt-auto">
                 <div class="flex items-center gap-2">
                    <div class="flex items-center border border-gray-100 dark:border-gray-800 rounded-md h-7 bg-gray-50 dark:bg-black/20">
                        <button 
                            class="w-6 h-full flex items-center justify-center text-gray-400 hover:text-red-500 transition-colors qty-btn"
                            data-item-id="{{ item.id }}"
                            data-action="decrease"
                        >
                            <span class="material-icons text-[10px]">remove</span>
                        </button>
                        <span class="w-6 text-center text-[10px] font-bold text-gray-900 dark:text-white">{{ item.quantity }}</span>
                        <button 
                            class="w-6 h-full flex items-center justify-center text-gray-400 hover:text-green-500 transition-colors qty-btn"
                            data-item-id="{{ item.id }}"
                            data-action="increase"
                        >
                            <span class="material-icons text-[10px]">add</span>
                        </button>
                    </div>
                    <div class="text-[10px] text-gray-500 dark:text-gray-400 font-mono">
                        x <span class="font-bold text-xiaomi">${{ item.product.price|floatformat:2 }}</span>
                    </div>
                 </div>
                 
                 <!-- Remove Button -->
                 <button 
                    class="text-gray-400 hover:text-red-500 transition-colors p-1.5 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 opacity-0 group-hover:opacity-100 remove-item-btn"
                    data-item-id="{{ item.id }}"
                    title="Eliminar"
                >
                    <span class="material-icons text-[16px]">delete_outline</span>
                 </button>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="text-center py-12 px-6">
        <div class="w-16 h-16 bg-gray-50 dark:bg-gray-800/50 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="material-icons text-3xl text-gray-400">remove_shopping_cart</span>
        </div>
        <p class="text-sm font-medium text-gray-900 dark:text-white">Tu carrito está vacío</p>
        <p class="text-xs text-gray-500 mt-1">¡Vamos de compras!</p>
    </div>
    {% endfor %}
</div>

<!-- Mini Cart Footer -->
{% if cart_count > 0 %}
<div class="p-5 border-t border-gray-100 dark:border-gray-800 bg-gray-50/80 dark:bg-black/40 backdrop-blur-md">
    <div class="flex justify-between items-end mb-5">
        <span class="text-xs text-gray-500 font-medium uppercase tracking-wider">Total Estimado</span>
        <span class="font-black text-2xl text-gray-900 dark:text-white font-display">${{ cart_total|floatformat:2 }}</span>
    </div>
    
    <div class="grid grid-cols-2 gap-3">
        <a href="{% url 'orders:cart_view' %}" class="flex items-center justify-center px-4 py-2.5 border border-gray-200 dark:border-gray-700 rounded-xl text-sm font-bold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 hover:border-gray-300 transition-all shadow-sm">
            Ver Todo
        </a>
        <a href="{% url 'orders:checkout' %}" class="flex items-center justify-center px-4 py-2.5 bg-gray-900 dark:bg-white text-white dark:text-black rounded-xl text-sm font-bold hover:shadow-lg hover:-translate-y-0.5 transition-all">
            Checkout
        </a>
    </div>
</div>
{% endif %}
